<template>
  <section class="py-12">
    <div class="relative">
      <!-- Navigation Buttons -->
      <button
        v-if="canScrollPrev"
        class="absolute right-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-white dark:bg-gray-800 rounded-full shadow-lg flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
        @click="scrollPrev"
      >
        <UIcon name="i-heroicons-chevron-right-20-solid" class="w-6 h-6 text-gray-700 dark:text-gray-300" />
      </button>

      <button
        v-if="canScrollNext"
        class="absolute left-0 top-1/2 -translate-y-1/2 z-10 w-10 h-10 bg-white dark:bg-gray-800 rounded-full shadow-lg flex items-center justify-center hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
        @click="scrollNext"
      >
        <UIcon name="i-heroicons-chevron-left-20-solid" class="w-6 h-6 text-gray-700 dark:text-gray-300" />
      </button>

      <!-- Carousel Container -->
      <div
        ref="carouselContainer"
        class="overflow-x-auto scrollbar-hide scroll-smooth mx-12"
        @scroll="handleScroll"
      >
        <div class="flex gap-4 pb-2">
          <!-- Category Cards -->
          <div
            v-for="category in categories"
            :key="category.id"
            class="flex-shrink-0 w-32 sm:w-36"
          >
            <button
              class="w-full p-4 rounded-xl bg-white dark:bg-gray-800 hover:bg-brand-50 dark:hover:bg-brand-900/20 transition-all group"
              :class="selectedCategory?.id === category.id ? ' bg-brand-50 dark:bg-brand-900/20' : ' hover:border-brand-300'"
              @click="selectCategory(category)"
            >
              <div class="flex flex-col items-center gap-3">
                <!-- Icon -->
                <div
                  class="w-14 h-14 rounded-full flex items-center justify-center transition-colors"
                  :class="selectedCategory?.id === category.id ? 'bg-brand-500' : 'bg-brand-100 dark:bg-brand-900/30 group-hover:bg-brand-200'"
                >
                  <UIcon
                    :name="category.icon"
                    class="w-7 h-7 transition-colors"
                    :class="selectedCategory?.id === category.id ? 'text-white' : 'text-brand-600 dark:text-brand-400'"
                  />
                </div>
                <!-- Text -->
                <div
                  class="text-sm font-medium text-center line-clamp-2"
                  :class="selectedCategory?.id === category.id ? 'text-brand-600 dark:text-brand-400' : 'text-gray-700 dark:text-gray-300'"
                >
                  {{ category.name }}
                </div>
              </div>
            </button>
          </div>
        </div>
      </div>

      <!-- Dots Indicator -->
      <div class="flex justify-center gap-2 mt-6">
        <div
          v-for="(dot, index) in totalDots"
          :key="index"
          class="w-2 h-2 rounded-full transition-all"
          :class="currentDot === index ? 'bg-brand-500 w-6' : 'bg-gray-300 dark:bg-gray-600'"
        />
      </div>
    </div>
  </section>
</template>

<script lang="ts">
import { defineComponent } from 'vue'

interface Category {
  id: number
  name: string
  icon: string
  slug: string
}

export default defineComponent({
  name: 'CategoriesCarousel',

  data() {
    return {
      selectedCategory: null as Category | null,
      canScrollPrev: false,
      canScrollNext: true,
      currentDot: 0,
      categories: [
        {
          id: 1,
          name: 'مسکن و ضد درد',
          icon: 'i-heroicons-heart',
          slug: 'pain-relief'
        },
        {
          id: 2,
          name: 'ویتامین و مکمل',
          icon: 'i-heroicons-beaker',
          slug: 'vitamins'
        },
        {
          id: 3,
          name: 'قلب و عروق',
          icon: 'i-heroicons-heart-pulse',
          slug: 'cardiovascular'
        },
        {
          id: 4,
          name: 'گوارش',
          icon: 'i-heroicons-sparkles',
          slug: 'digestive'
        },
        {
          id: 5,
          name: 'پوست و مو',
          icon: 'i-heroicons-user',
          slug: 'skin-hair'
        },
        {
          id: 6,
          name: 'اعصاب و روان',
          icon: 'i-heroicons-brain',
          slug: 'mental-health'
        },
        {
          id: 7,
          name: 'تنفسی',
          icon: 'i-heroicons-lungs',
          slug: 'respiratory'
        },
        {
          id: 8,
          name: 'کودکان',
          icon: 'i-heroicons-baby',
          slug: 'children'
        },
        {
          id: 9,
          name: 'زنان',
          icon: 'i-heroicons-venus',
          slug: 'women'
        },
        {
          id: 10,
          name: 'دیابت',
          icon: 'i-heroicons-drop',
          slug: 'diabetes'
        },
        {
          id: 11,
          name: 'آنتی بیوتیک',
          icon: 'i-heroicons-shield-check',
          slug: 'antibiotics'
        },
        {
          id: 12,
          name: 'چشم و بینایی',
          icon: 'i-heroicons-eye',
          slug: 'eye-care'
        }
      ] as Category[]
    }
  },

  computed: {
    totalDots(): number {
      const container = this.$refs.carouselContainer as HTMLElement
      if (!container) return 1
      const itemsPerView = Math.floor(container.clientWidth / 152) // 144px width + 16px gap
      return Math.ceil(this.categories.length / itemsPerView)
    }
  },

  mounted() {
    this.handleScroll()
  },

  methods: {
    scrollPrev() {
      const container = this.$refs.carouselContainer as HTMLElement
      if (container) {
        const scrollAmount = container.clientWidth * 0.8
        container.scrollBy({ left: -scrollAmount, behavior: 'smooth' })
      }
    },

    scrollNext() {
      const container = this.$refs.carouselContainer as HTMLElement
      if (container) {
        const scrollAmount = container.clientWidth * 0.8
        container.scrollBy({ left: scrollAmount, behavior: 'smooth' })
      }
    },

    handleScroll() {
      const container = this.$refs.carouselContainer as HTMLElement
      if (container) {
        this.canScrollPrev = container.scrollLeft > 10
        this.canScrollNext = container.scrollLeft < container.scrollWidth - container.clientWidth - 10

        // Calculate current dot
        const maxScroll = container.scrollWidth - container.clientWidth
        if (maxScroll > 0) {
          const scrollPercentage = container.scrollLeft / maxScroll
          this.currentDot = Math.round(scrollPercentage * (this.totalDots - 1))
        }
      }
    },

    selectCategory(category: Category) {
      this.selectedCategory = category
      // Navigate to medications page with category filter
      this.$router.push(`/medications?category=${category.slug}`)
    }
  }
})
</script>

<style scoped>
/* Hide scrollbar */
.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
</style>
